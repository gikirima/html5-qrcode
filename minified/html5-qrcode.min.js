!function(e){var t=[];"undefined"==typeof MediaStreamTrack||void 0===MediaStreamTrack.getSources?console.log("This browser does not support MediaStreamTrack.\n\nTry Chrome."):MediaStreamTrack.getSources(function(e){for(var a=0;a!==e.length;++a){var o=e[a];"video"===o.kind&&t.push(o.id)}}),jQuery.fn.extend({html5_qrcode:function(a,o,r,i){return this.each(function(){var d=e(this);e.data(d[0],"qrcodeSuccess",a),e.data(d[0],"qrcodeError",o),e.data(d[0],"videoError",r),void 0!==i&&void 0!==t[i]?e.data(d[0],"sourceId",i):e.data(d[0],"sourceId",0),void 0!==t[d.data("sourceId")]&&e.data(d[0],"cameraId",t[d.data("sourceId")]);var n=d.height(),c=d.width();null==n&&(n=250),null==c&&(c=300);var s,u=e('<video width="'+c+'px" height="'+n+'px"></video>').appendTo(d),h=e('<canvas id="qr-canvas" width="'+(c-2)+'px" height="'+(n-2)+'px" style="display:none;"></canvas>').appendTo(d),l=u[0],m=h[0].getContext("2d"),v=function(){if(s){m.drawImage(l,0,0,307,250);try{qrcode.decode()}catch(e){o(e,s)}e.data(d[0],"timeout",setTimeout(v,500))}else e.data(d[0],"timeout",setTimeout(v,500))};window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(navigator.getUserMedia){var f={video:!0};void 0!==d.data("cameraId")&&(f={video:{optional:[{sourceId:d.data("cameraId")}]}}),navigator.getUserMedia(f,function(t){l.srcObject=t,s=t,e.data(d[0],"stream",t),l.play(),e.data(d[0],"timeout",setTimeout(v,1e3))},function(e){"function"==typeof r?r(e,s):console.log("Error callback is undefined or not a function.")})}else console.log("Native web camera streaming (getUserMedia) not supported in this browser.");qrcode.callback=function(e){"function"==typeof a?a(e,s):console.log("Success callback is undefined or not a function.")}})},html5_qrcode_stop:function(){return this.each(function(){e(this).data("stream").getVideoTracks().forEach(function(e){e.stop()}),e(this).children("video").remove(),e(this).children("canvas").remove(),clearTimeout(e(this).data("timeout"))})},html5_qrcode_changeCamera:function(){return this.each(function(){e(this).html5_qrcode_stop(),e(this).html5_qrcode(e(this).data("qrcodeSuccess"),e(this).data("qrcodeError"),e(this).data("videoError"),(e(this).data("sourceId")+1)%t.length)})},html5_qrcode_cameraCount:function(){return t.length}})}(jQuery);